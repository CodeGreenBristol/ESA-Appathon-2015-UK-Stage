<!DOCTYPE HTML>
<html>
    <head>
        <title>ESA Hackathon</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="author" content="" /> 
		<meta name="description" content="" /> 
		<meta name="keywords" content="" />
		<link rel="shortcut icon" type="image/png" href="" />
		<!-- PAGE CSS -->
        <link rel="stylesheet" type="text/css" href="css/fonts.css">
        <link rel="stylesheet" type="text/css" href="css/index.css">       
  </head>
  <body>
    <div id="insight-container">
    
    </div>
    <div id="map-canvas"></div>
    <script src="js/jquery-1.11.2.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=drawing"></script>
    <script>
        var drawingManager;
        var currentPolygon;
        var map;
            
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(49.00, 32.00),
                zoom: 6,
                disableDefaultUI: true,
                zoomControl: true,
                mapTypeControl: true,
                zoomControlOptions: { style: google.maps.ZoomControlStyle.SMALL }
            };
        
            map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        
            drawingManager = new google.maps.drawing.DrawingManager({
                drawingMode: null,
                drawingControl: true,
                drawingControlOptions: {
                  position: google.maps.ControlPosition.TOP_LEFT,
                  drawingModes: [
                    google.maps.drawing.OverlayType.POLYGON
                  ]
                },
                polygonOptions: {
                    fillColor: "#7092ff",
                    fillOpacity: 0.35,
                    strokeColor: "#7092ff",
                    strokeWeight:4
                }
            });
            drawingManager.setMap(map);
            google.maps.event.addListener(drawingManager, 'polygoncomplete', function (polygon) {
                drawingManager.setDrawingMode(null);
                var coordinates = (polygon.getPath().getArray());
                console.log(coordinates);
                currentPolygon = polygon;
                var i;
                var lon=0.0;
                var lat=0.0;
                for(i=0;i<coordinates.length;i++){
                    var temp=coordinates[i];
                     lat=lat+ temp["k"];
                     lon=lon+ temp["D"];
                }
                lat=lat/i;
                lon=lon/i;
                console.log(lat);
                console.log(lon);
                var tmpurl="https://api.forecast.io/forecast/9ac2823be7891b91dfcac3cf3b2395e3/"+lat.toString()+","+lon.toString();
                console.log(tmpurl);
                $.ajax({
                    url: tmpurl,
                    dataType: "jsonp",
                    success: function (data) {
                    console.log(data);
                    }
            });
            
            console.log((google.maps.geometry.spherical.computeArea(polygon.getPath())/4046.9).toFixed(2));

            });
        
            google.maps.event.addListenerOnce(map, 'idle', function(){
                $('div[title="Draw a shape"]').click(function(){
                    if(currentPolygon) currentPolygon.setMap(null);
                });
            });
        }
        
        google.maps.event.addDomListener(window, 'load', initialize);
        
    </script>
  </body>
</html>