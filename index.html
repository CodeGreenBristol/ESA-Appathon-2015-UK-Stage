<!DOCTYPE HTML>
<html>
    <head>
        <title>ESA Hackathon</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="author" content="" /> 
		<meta name="description" content="" /> 
		<meta name="keywords" content="" />
		<link rel="shortcut icon" type="image/png" href="" />
		<!-- PAGE CSS -->
        <link rel="stylesheet" type="text/css" href="css/fonts.css">
        <link rel="stylesheet" type="text/css" href="css/index.css">       
  </head>
  <body>
    <div id="initial-popup">
        <div id="popup-header">Welcome!</div>
        <div id="popup-text">Tap the Draw icon and outline the area you'd like insights on to get started.</div>
        <div id="popup-close">DISMISS</div>
    </div>
    <div id="insight-container">
    
    </div>
    <div id="map-canvas">
    </div>
    <script src="js/jquery-1.11.2.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=drawing"></script>
    <script>
    
        $('#popup-close').click(function(){
            $(this).parent().fadeOut();
        });
        
        var drawingManager;
        var currentPolygon;
        var map;
            
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(49.00, 32.00),
                zoom: 6,
                disableDefaultUI: true,
                //zoomControl: true,
                mapTypeControl: true,
                zoomControlOptions: { style: google.maps.ZoomControlStyle.SMALL }
            };
        
            map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            
            var zoomControls = document.createElement('div');
            var zoomControlsIn = document.createElement('div');
            var zoomControlsOut = document.createElement('div');
            zoomControls.id = "zoom-controls";
            zoomControlsIn.id = "zoom-in";
            zoomControlsOut.id = "zoom-out";
            zoomControlsIn.innerHTML = '<img src="img/zoom-in.png" alt="Zoom in" title="Zoom in" />';
            zoomControlsOut.innerHTML = '<img src="img/zoom-out.png" alt="Zoom out" title="Zoom out" />';
            zoomControls.appendChild(zoomControlsIn);
            zoomControls.appendChild(zoomControlsOut);
            
            google.maps.event.addDomListener(zoomControlsIn, 'click', function(){
                if(map.getZoom() != 21) map.setZoom(map.getZoom() + 1);
            });
            
            google.maps.event.addDomListener(zoomControlsOut, 'click', function(){
                if(map.getZoom() != 0) map.setZoom(map.getZoom() - 1);
            });
            
            zoomControls.index = 1;
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(zoomControls);
            
            var drawControls = document.createElement('div');
            var drawControlsPan = document.createElement('div');
            var drawControlsDraw = document.createElement('div');
            drawControls.id = "draw-controls";
            drawControlsPan.id = "draw-controls-pan";
            drawControlsPan.className = "active";
            drawControlsDraw.id = "draw-controls-draw";
            drawControlsPan.innerHTML = '<img src="img/pan.png" alt="Pan" title="Pan map" />';
            drawControlsDraw.innerHTML = '<img src="img/draw.png" alt="Draw" title="Draw a shape" />';
            drawControls.appendChild(drawControlsPan);
            drawControls.appendChild(drawControlsDraw);
            
            drawControls.index = 1;
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(drawControls);
            
            drawingManager = new google.maps.drawing.DrawingManager({
                drawingMode: null,
                drawingControl: false,
                polygonOptions: {
                    fillColor: "#7092ff",
                    fillOpacity: 0.35,
                    strokeColor: "#7092ff",
                    strokeWeight:4
                }
            });
            drawingManager.setMap(map);
            google.maps.event.addListener(drawingManager, 'polygoncomplete', function (polygon) {
            
                drawingManager.setDrawingMode(null);
                $('#draw-controls-draw').removeClass('active');
                $('#draw-controls-pan').addClass('active');
                
                var coordinates = (polygon.getPath().getArray());
                console.log(coordinates);
                
                if(!currentPolygon){
                    $('#initial-popup').fadeOut();
                    $('#map-canvas').animate({width: $(window).width() - 350 + "px"}, 500);
                    $('#insight-container').animate({width: "350px"}, 500);
                }
                
                currentPolygon = polygon;
                
                
            });
            
            
            google.maps.event.addListenerOnce(map, 'idle', function(){
                $('#draw-controls-draw').click(function(){
                    if(currentPolygon) currentPolygon.setMap(null);
                });
            });
        }
        
        google.maps.event.addDomListener(window, 'load', initialize);
        
        $('#map-canvas').on('click', '#draw-controls-draw', function(){
            drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON);
            $(this).addClass('active');
            $('#draw-controls-pan').removeClass("active");
        });
        
        $('#map-canvas').on('click', '#draw-controls-pan', function(){
            drawingManager.setDrawingMode(null);
            $(this).addClass('active');
            $('#draw-controls-draw').removeClass("active");
        });
        
    </script>
  </body>
</html>